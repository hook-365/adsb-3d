================================================================================
ADSB 3D VISUALIZATION - CODEBASE STRUCTURE SUMMARY
================================================================================

PROJECT OVERVIEW
================================================================================
Type:               Monolithic Frontend SPA + Backend Service
Total LOC:          15,168 lines
Primary Language:   JavaScript (13,817 lines) + Python (1,351 lines)
Architecture:       Single-page application with REST backend

================================================================================
FILE SIZE BREAKDOWN
================================================================================

FRONTEND (Public Assets):
  /public/app.js                    12,428 lines   484 KB   [MONOLITH]
  /public/aircraft-svg-system.js     1,389 lines    41 KB   [Modular]
  /public/aircraft-shapes.js           270 lines     8 KB   [Legacy]
  /public/index.html                 2,000 lines   132 KB   [Template]
                                   ─────────────
  Subtotal Frontend:                15,817 lines

BACKEND (Python):
  /track-service/main.py             1,351 lines    50 KB   [API Service]
                                   ─────────────
TOTAL:                             15,168 lines   716 KB

================================================================================
APP.JS STRUCTURE (12,428 LINES)
================================================================================

Line Range    Lines    % of File    Section Name
────────────────────────────────────────────────────────────────────────────
1-31           31      0.2%        File header and documentation
32-786         755     6%          THEME SYSTEM
                                   - CSS variable bridge
                                   - 5+ theme presets (Dark, Light, etc.)
                                   - Dynamic theming

788-1272       485     4%          URL STATE MANAGEMENT
                                   - Browser history API
                                   - Shareable links (aircraft selection)

1274-1380      107     1%          FEATURE DETECTION
                                   - Runtime capability checking
                                   - Live vs Historical mode detection

1382-1440       59     0.5%        DATA STRUCTURES (Historical)
1442-1524       83     0.7%        DATA STRUCTURES (Statistics)
                                   - State objects initialization
                                   - Global variable declarations

1536-1741      206     1.7%        ALTITUDE SMOOTHING
                                   - MLAT data quality handling
                                   - Outlier detection and smoothing

1741-2127      387     3%          AIRCRAFT DATA UTILITIES
                                   - Military database (16,896+ aircraft)
                                   - Aircraft specifications
                                   - Signal quality calculations

2129-2372      244     2%          AIRCRAFT RENDERING SYSTEM
                                   - SVG sprite integration
                                   - Shape-based rendering

2374-3917    1,544    12%          HISTORICAL MODE FUNCTIONS
                                   - Track loading and display
                                   - Heat map generation (cells)
                                   - Flight corridor visualization
                                   - Multiple rendering modes

3920-4271      352     3%          PLAYBACK ANIMATION
                                   - Timeline animation engine
                                   - Timeline seeking
                                   - Playback controls

4274-5079      806     6%          LIVE MODE CONTROLS
                                   - UI control bindings
                                   - Mode switching
                                   - Settings and preferences

5079-5208      130     1%          INITIALIZATION FUNCTION
                                   - App startup
                                   - Feature detection
                                   - Preference loading

5209-5361      153     1%          THREE.JS SETUP
                                   - Scene, camera, renderer
                                   - Lights and fog
                                   - Input handlers

5361-5665      305     2%          GROUND & SKY RENDERING
                                   - Map tile loading
                                   - Distance rings
                                   - Day/night sky gradient

5665-5903      239     2%          AIRPORT/RUNWAY FUNCTIONS
                                   - CSV data parsing
                                   - Runway geometry generation
                                   - Runway rendering

5903-10217   4,315    35%          LIVE DATA FETCHING & RENDERING
                                   - Aircraft data polling (1 Hz)
                                   - Mesh creation and updates
                                   - Trail rendering (3+ modes)
                                   - Trail cleanup and management
                                   - Label updates
                                   - Click/selection handling

10217-11063    847     7%          MOBILE TOUCH UX
                                   - Touch gesture detection
                                   - Long-press handling
                                   - Context menus
                                   - Mobile optimizations

11063-12131  1,069     9%          SIDEBAR EVENT HANDLERS
                                   - Aircraft search
                                   - Detail panel
                                   - Mode switching
                                   - Settings panel
                                   - Theme modal

12131-12336    206     1.7%        SIDEBAR RADAR & COMPASS
                                   - Mini radar canvas
                                   - Heading compass
                                   - Real-time updates

12336-12428     93     0.7%        THEME UI HANDLERS
                                   - Theme selection
                                   - Modal dialogs

================================================================================
MAJOR FUNCTIONAL AREAS
================================================================================

1. REAL-TIME LIVE TRACKING (4,315 lines, 35%)
   ├── Data fetching (1 request/second from /data/aircraft.json)
   ├── Mesh creation/updates for 1000+ aircraft
   ├── Trail rendering with 3+ color modes
   ├── Selection and detail view
   ├── Trail fading and cleanup
   └── Continuously running animation loop

2. 3D SCENE MANAGEMENT (2,500 lines)
   ├── Three.js initialization
   ├── Camera controls (mouse, keyboard, touch)
   ├── Aircraft rendering (sprites vs geometry)
   ├── Altitude lines and distance rings
   ├── Ground plane with map tiles
   ├── Sky gradients and day/night cycle
   └── Geometry disposal and memory management

3. HISTORICAL PLAYBACK (1,900 lines)
   ├── Track loading from API
   ├── Heat map generation
   ├── Flight corridor visualization
   ├── Timeline animation
   ├── Playback controls (play/pause/seek)
   └── Multiple display modes (show-all, playback)

4. UI & INTERACTION (2,100 lines)
   ├── Sidebar panel (Live and Historical tabs)
   ├── Aircraft search and filtering
   ├── Settings modal
   ├── Theme selector modal
   ├── Detail panels
   ├── Playback timeline
   ├── Mobile touch handling
   └── Settings persistence

5. DATA MANAGEMENT (1,300 lines)
   ├── State objects (12 major objects)
   ├── URL state for shareable links
   ├── Feature detection
   ├── Settings persistence (localStorage)
   ├── Statistics tracking
   ├── Military database
   └── Caching (routes, military data)

6. THEME SYSTEM (755 lines)
   ├── CSS variable bridge
   ├── Theme presets
   ├── Dynamic color switching
   ├── Scene color updates
   └── Theme persistence

================================================================================
GLOBAL STATE (80+ VARIABLES IN APP.JS)
================================================================================

Scene/Rendering:        scene, camera, renderer, controls, sky
Aircraft Data:          aircraftMeshes (Map), aircraftLabels (Map)
Trails:                 trails (Map), staleTrails (Map), altitudeLines (Map)
Selection:              selectedAircraft, followMode, followedAircraftHex
Display:                showTrails, showLabels, showAltitudeLines, showTronMode
Historical:             HistoricalState, PlaybackState, RecentTrailsState
Live Stats:             StatsState, militaryDatabase
UI State:               currentMode, sidebarState, currentlyHoveredListItem
Settings:               CONFIG, trailColorMode, autoFadeTrails, trailFadeTime
Timing:                 liveUpdateInterval, lastFrameTime, animation timestamps
Caching:                militaryDatabaseLoaded, ROUTE_CACHE_KEY

================================================================================
KEY DEPENDENCIES
================================================================================

External Libraries:
  ├── THREE.js v140         - 3D rendering engine
  ├── aircraft-svg-system   - SVG aircraft shapes (1,389 lines)
  └── aircraft-shapes       - Legacy shapes (270 lines, deprecated)

Data Sources:
  ├── /data/aircraft.json   - Live aircraft data (polling every 1s)
  ├── /api/health           - Backend health check
  ├── /api/tracks           - Historical track queries
  ├── /api/tracks/{icao}    - Full track history
  ├── /api/recent           - Recent trails (last N minutes)
  └── External APIs:
      ├── github.com - Military aircraft database (16,896 aircraft)
      ├── adsbdb.com - Flight route API
      └── CartoDB/OSM/Esri - Map tiles

Internal:
  ├── index.html (104 DOM elements with IDs)
  ├── localStorage (settings, stats, cache)
  ├── sessionStorage (runtime state)

================================================================================
COMPLEXITY METRICS
================================================================================

Functions:              ~182 in app.js
  - Longest:           ~500 lines (animate, loadHistoricalTracks)
  - Most called:       animate() (every frame ~60 FPS)
  - Async functions:   ~25 (data fetching, loading)

State Objects:         12 major objects
  - CONFIG:            1 large configuration object
  - URLState:          1 complex state object
  - HistoricalState:   1 complex state object
  - PlaybackState:     1 animation state object
  - Plus 8 others

Nesting Depth:         5-6 levels deep (worst case)
  - DOM manipulation loops
  - Geometry generation
  - Event handler chains

Code Organization:     20 major sections
  - Well-commented headers
  - Logical grouping by feature
  - Mix of utilities and features

================================================================================
STRENGTHS
================================================================================

✓ Well-commented sections with clear headers
✓ Good separation of concerns into state objects
✓ Feature detection for capability management
✓ Three.js optimization (geometry disposal, memory management)
✓ Comprehensive error handling with fallbacks
✓ Settings persistence across sessions
✓ Mobile-responsive design
✓ Multiple rendering modes (sprites, geometry, Tron mode)
✓ Rich feature set (live tracking, historical playback, heat maps)

================================================================================
WEAKNESSES
================================================================================

✗ Single 12,428-line file (monolithic)
✗ Global scope pollution (~80 global variables)
✗ Tight coupling between rendering, UI, and data
✗ No module/component boundaries
✗ Difficult to test individual systems
✗ Hard to reuse code in other projects
✗ 104 DOM ID references scattered throughout code
✗ Duplicated logic (trail rendering, mesh creation)
✗ No error boundaries (failure propagation)
✗ Mixed concerns (theme, feature detection, data fetching)
✗ State management complexity
✗ Mobile/desktop UI duplication

================================================================================
REFACTORING PRIORITIES
================================================================================

CRITICAL (Extract First):
  1. Extract 3D Rendering Module      (~2,800 lines)
  2. Extract Data Services             (~2,200 lines)
  3. Extract State Management          (~1,300 lines)
  4. Extract Trail Rendering           (~1,500 lines)

HIGH PRIORITY:
  5. Extract UI Framework              (~2,100 lines)
  6. Extract Theme System              (~755 lines)
  7. Extract Feature Detection         (~107 lines)

MEDIUM PRIORITY:
  8. Extract Utility Libraries         (scattered lines)
  9. Extract Constants & Config        (scattered lines)
  10. Extract Mobile Support           (~847 lines)

ESTIMATED EFFORT:
  Phase 1 (Utilities):        1-2 weeks
  Phase 2 (Services):         2-3 weeks
  Phase 3 (Features):         3-4 weeks
  Phase 4 (UI):               2-3 weeks
  Phase 5 (Testing):          2-3 weeks
  ──────────────────────
  Total:                       10-15 weeks

================================================================================
QUICK WINS
================================================================================

1. Extract Theme System (lines 106-786)
   Time: 2 days | Impact: 680 lines removed | Risk: Low

2. Extract URL State (lines 788-1272)
   Time: 2 days | Impact: 485 lines removed | Risk: Low

3. Extract Constants
   Time: 1 day | Impact: Easier configuration | Risk: Very Low

4. Extract Utilities
   Time: 3 days | Impact: 200-300 lines removed | Risk: Very Low

================================================================================
RECOMMENDED READING ORDER
================================================================================

1. Start with lines 32-105 (Theme System - well-organized)
2. Read lines 1380-1440 (State object definitions)
3. Scan lines 5209-5360 (init() function - entry point)
4. Study lines 5903-6500 (Live data fetching - core loop)
5. Examine lines 9767-9900 (animate() - main rendering loop)
6. Review lines 2374-3917 (Historical mode - complex feature)

================================================================================
